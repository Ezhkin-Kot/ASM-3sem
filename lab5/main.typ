#import "conf.typ": conf
#import "@preview/zebraw:0.5.5": zebraw, zebraw-init, zebraw-themes
#show: conf.with(
  title: [Лабораторная работа №5],
  type: "pract",
  info: (
    author: (
      name: [Тюменцева Радомира Александровича],
      faculty: [КНиИТ],
      group: "251",
      sex: "male",
    ),
    inspector: (
      degree: "Старший преподаватель",
      name: "Е. М. Черноусова",
    ),
  ),
  settings: (
    title_page: (
      enabled: true,
    ),
    contents_page: (
      enabled: false,
    ),
  ),
)

= Задание 5

*Вариант 1.* Изображение показано на рисунке 5.4. и состоит из 6 строк символов начиная с символа A (ASCII 41h) и далее по алфавиту с разными атрибутами начиная с 09h и далее плюс один.  В каждой строке количество символов увеличивается на 1, начальная позиция вывода 5:10. Надо выполнить задание, используя прямую работу с видеопамятью.

#figure(
  image("image5_1.png"),
  caption: [Рисунок 5.4],
)

== Алгоритм программы

Программа настраивает доступ к видеопамяти через сегмент ES, сохраняет текущий видеорежим и переключает экран в текстовый режим 03h с активной страницей 0.

Процедура B10DISPLAY выводит в видеопамять ступенчатый набор символов. Начинается вывод с позиции строки 5 и столбца 10, используя символ A и атрибут 09h. Адрес видеопамяти для каждой строки вычисляется по формуле ((строка \* 80) + столбец) \* 2.

Внутренний цикл записывает в видеопамять несколько одинаковых символов, количество которых уменьшается по мере прохода внешнего цикла. После каждой строки символ и его атрибут увеличиваются, а номер строки сдвигается вниз.

После вывода всех строк программа ждёт нажатия клавиши, затем восстанавливает исходный видеорежим и завершает работу.

== Текст программы на языке ассемблера с комментариями

```asm
.model small
.stack 100h
.186
.code
start:
  mov AX, @data
  mov DS, AX

  ; Настраиваем запись данных в видеопамять на страницу 0
  mov AX, 0B800h
  mov ES, AX

  mov AH, 0Fh
  int 10h
  push AX; Сохранение текущего видеорежима и активной страницы

  ; Установка видеорежима 03h (80x25, 16 цветов)
  mov AH, 00h
  mov AL, 03h
  int 10h

  ; Установка активной страницы 0
  mov AH, 05h
  mov AL, 00h
  int 10h

  call B10DISPLAY

  ; Ожидание нажатия любой клавиши
  mov AH, 00h
  int 16h

  ; Восстановление исходного видеорежима и страницы
  pop AX
  mov AH, 00h
  int 10h

  ; Завершение программы
  mov AX, 4C00h
  int 21h

  ; Процедура вывода изображения в видеопамять
  B10DISPLAY proc
    pusha

    ; Начальные координаты:
    mov CX, 5; Строка
    mov BP, 10; Столбец

    mov AL, 41h; ASCII-код символа A
    mov AH, 09h; Атрибут светло-синего цвета

    mov SI, 6; Счётчик строк
    rows_loop:
      ; Вычисление адреса в видеопамяти для текущей позиции
      ; Адрес = ((строка * 80) + столбец) * 2
      push AX
      mov AX, CX      ; AX = строка
      mov BX, 80
      mul BX          ; AX = строка * 80
      add AX, BP      ; AX = (строка * 80) + столбец
      mov BX, 2
      mul BX          ; AX = ((строка * 80) + столбец) * 2

      mov DI, AX      ; DI = указатель на начало строки в видеопамяти
      pop AX

      ; Количество символов в текущей строке = 7 - SI
      mov BX, 7
      sub BX, SI
      cols_loop:
        mov ES:word ptr[DI], AX; Запись символа и атрибута в видеопамять
        add DI, 2; Сдвиг на следующую позицию
        dec BX
        cmp BX, 0
        jne cols_loop

      ; Изменение символа и атрибута
      inc AL
      inc AH

      ; Сдвиг на следующую строку
      inc CX

      ; Уменьшение счётчика строк
      dec SI
      cmp SI, 0
      jne rows_loop

    popa
    ret
  B10DISPLAY endp

end start
```
#text(size: 12pt, align(center)[Текст программы])
#pagebreak(weak: true)

== Скриншот запуска программы
#figure(
  image("1.png"),
  caption: [Запуск программы],
)

= Ответы на контрольные вопросы

*1. Каков адрес области видеоданных для*
- *режимов 00h - 06h;*
- *монохромного текстового режима;*

Для цветных текстовых и графических режимов `00h` - `06h` начальный адрес равен `B800h`.

Для монохромного текстового режима (`07h`) начальный адрес равен `B000h`.

*2. Укажите число страниц, разрешение и число цветов для видеорежима 03.*

- Разрешение: 80 столбцов на 25 строк, 720x400 пикселей
- Число цветов символа: 16
- Число страниц: 4

*3. Укажите в двоичной форме содержимое байтов атрибутов для*
- *пурпурных символов на голубом фоне;*
- *зеленых символов на белом мигающем фоне.*

#set align(center)
#table(
  columns: 9,
  stroke: none,
  inset: 2.5pt,
  align: center,
  table.hline(),
  table.header([], [*BL*], [*R*], [*G*], [*B*], [*I*], [*R*], [*G*], [*B*]),

  table.hline(),
  table.vline(x: 0),
  table.vline(x: 1),
  table.vline(x: 2),
  table.vline(x: 3),
  table.vline(x: 4),
  table.vline(x: 5),
  table.vline(x: 6),
  table.vline(x: 7),
  table.vline(x: 8),
  table.vline(x: 9),

  [Бит], [7], [6], [5], [4],
  [3], [2], [1], [0],
  table.hline(),
  [A], [0], [0], [1], [1],
  [0], [1], [0], [1],
  table.hline(),
  [B], [1], [1], [1], [1],
  [0], [0], [1], [0],
  table.hline(),
)
#set align(left)

*4. Объясните, как ограничивается количество доступных цветов для символа и для фона структурой байта атрибутов.*

Байт атрибутов определяет свойства каждого выводимого символа. Когда программа устанавливает атрибут, он остается в установленном состоянии до следующего явного изменения.

#set align(center)
#table(
  columns: 9,
  stroke: none,
  inset: 2.5pt,
  align: center,
  table.hline(),
  table.header(
    [],
    table.cell(colspan: 4, [*Фон*]),
    table.cell(colspan: 4, [*Символ*]),
  ),

  table.hline(),
  table.vline(x: 0),
  table.vline(x: 1),
  table.vline(x: 2),
  table.vline(x: 3),
  table.vline(x: 4),
  table.vline(x: 5),
  table.vline(x: 6),
  table.vline(x: 7),
  table.vline(x: 8),
  table.vline(x: 9),

  [Атрибут], [BL], [R], [G], [B], [I], [R], [G], [B],
  table.hline(),
  [Номер бита], [7], [6], [5], [4],
  [3], [2], [1], [0],
  table.hline(),
)
#set align(left)

Буквы R, G, B указывают позиции битов, соответствующих красному, зеленому, и синему цветам.
- Бит 7 (BL) устанавливает атрибут мерцания (может бать заблокирован)
- Биты 6-4 определяют цвет фона символа
- Бит 3 (I) устанавливает для символа нормальную (0) или повышенную (1) яркость.
- Биты 2-0 определяют составляющие цвета символа.

Фон может иметь один из восьми цветов, а сам символ один из шестнадцати:

#figure(
  image("colors.GIF"),
  caption: [Таблица типичных значений атрибутов символов.],
)

*5. Укажите инструкции, необходимые для вывода на экран с помощью функции 09h прерывания INT 10h*
- *10 желтых сердечек (ASCII 03h) на синем фоне;*
- *5 белых звездочек (ASCII 2Ah) на красном фоне.*

- 10 желтых сердечек (ASCII 03h) на синем фоне:
```asm
mov AH, 09h ; Запросить вывод (в текстовом режиме)
mov AL, 03h ; Символ сердечка
mov BH, 00h ; Страница 0
mov BL, 1Eh ; Синий фон, желтый символ
mov CX, 10  ; Число выводимых символов
int 10h     ; Вызвать обработчик прерывания
```

- 5 белых звёздочек (ASCII 2Ah) на красном фоне:
```asm
mov AH, 09h ; Запросить вывод (в текстовом режиме)
mov AL, 2Ah ; Символ звёздочки
mov BH, 00h ; Страница 0
mov BL, 47h ; Красный фон, белый символ
mov CX, 5   ; Число выводимых символов
int 10h     ; Вызвать обработчик прерывания
```
